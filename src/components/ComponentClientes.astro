---
import '../styles/global.css';
import { actions } from "astro:actions";
const {data, error} = await Astro.callAction(actions.getClientesConUltimaPuntuacion, {})

// ...existing code...

---

<section class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-100 to-green-100">
	<div class="w-full max-w-3xl bg-white rounded-2xl shadow-xl p-8">
		<h2 class="text-3xl font-extrabold text-center text-blue-700 mb-6">Clientes</h2>
			{error && <p class="text-red-500 text-center">{error.message}</p>}
				{!data && (
					<div class="flex flex-col items-center justify-center mb-6">
						<div class="animate-spin rounded-full h-8 w-8 border-t-4 border-b-4 border-blue-500 mb-2"></div>
						<p class="text-center text-blue-500 text-lg font-semibold animate-pulse">Cargando clientes...</p>
					</div>
				)}
			{Array.isArray(data) && data.length > 0 ? (
			 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
				 {data.map((cliente, idx) => {
					 const puntuacion = cliente.ultimaPuntuacion;
					 return (
						 <div class="border rounded-lg p-4 bg-gradient-to-br from-blue-800 to-green-700 shadow-lg">
							 <span class="inline-block bg-blue-700 text-white rounded-full px-3 py-1 text-sm font-bold shadow">ID</span>
							 <span class="text-lg font-semibold text-blue-100 tracking-widest">{cliente.id ?? 'Sin ID'}</span>
							 <span class="inline-block bg-gradient-to-r from-green-400 to-blue-400 text-white rounded-full px-3 py-1 text-xs font-bold shadow">{puntuacion?.segmento_categorico ?? 'Sin segmento'}</span>
							 <div class="text-2xl font-extrabold text-[#00c6ff] mb-1 drop-shadow futuristic-title">{cliente.nombre_empresa ?? 'Sin nombre'}</div>
							 <div class="text-gray-300 text-sm mb-2 italic">Empresa registrada</div>
							 <div class="grid grid-cols-2 gap-2 w-full mb-2">
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Recency:</span> {puntuacion?.recency ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Frecuencia:</span> {puntuacion?.frecuencia ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Volumen Total:</span> {puntuacion?.volumen_total ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Margen Promedio:</span> {puntuacion?.margen_promedio ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Score Volumen:</span> {puntuacion?.puntuacion_volumen ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Score Margen:</span> {puntuacion?.puntuacion_margen ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Score Recency:</span> {puntuacion?.puntuacion_recency ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Score Frecuencia:</span> {puntuacion?.puntuacion_frecuencia ?? 'N/A'}
								 </div>
								 <div class="bg-[#1a2980] bg-opacity-60 rounded-lg p-2 text-white text-xs shadow">
									 <span class="font-bold">Ponderación VCS:</span> {puntuacion?.ponderacion_vcs ?? 'N/A'}
								 </div>
							 </div>
							 <div class="w-full flex justify-end mt-2">
								 <a href={`/cliente/${cliente.id_cliente}`} class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 text-sm shadow-lg">
									 Ver Detalles
								 </a>
							 </div>
						 </div>
					 );
				 })}
			 </div>
		 ) : (
			 <p class="text-center text-gray-500">No hay clientes registrados.</p>
		 )}

				{/* Mostrar la data en formato JSON para depuración */}

		</div>
</section>
